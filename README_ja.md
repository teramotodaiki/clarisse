# Clarisse

IP アドレスからおおよその地域を割り出し、香川県からアクセスされた場合のみ `これはゲームではありません ネット・ゲームを制限する条例の対象外です。` と表示するスクリプトです。

自分のサイトが規制の対象でないことを香川県の方に伝えたいサイト運営者が利用することを想定していますが、コードは MIT ライセンスですので、自己責任で利用して下さい。

## Motivation

１８歳未満の子どもに対して「ゲームは１日６０分まで」等とする [ネット・ゲーム依存症対策条例](https://www.pref.kagawa.lg.jp/gikai/jyoho/giketsu/0202_hatugi01.pdf) が香川県議会で３月１８日、可決されました。

このスクリプトは、その条例の成立を受けて書いたものですが、議会の決定を非難するものでもなければ、阻害するためのものでもありません。

僕が最も危惧しているのは、「ネット・ゲーム」の具体的な定義が示されていないことです。そして、子どもが依存症と診断されれば、親は責任を果たせていないことにされてしまいます。

これでは人々が疑心暗鬼になり、あらゆるサイトやゲームに対して無差別攻撃を始めかねません。ただ有名になりたいだけの野次馬も大勢やってきて非難し始めるでしょう。

そこで非難の対象となるサイトやゲームの中には、**子どもたちの創造性を高めたり、生きる上で大切なことを教えてくれたりする、素晴らしいものも含まれている**ことを理解して貰わなければなりません。

条例を真に受けた大人たちの手によって、子どもたちから「創造的な活動」が奪われることのないように、ウェブサービスの運営者として何が出来るかを考える必要がありました。

そこで思いついたのが、「規制の対象ではない」と明示することです。これは、香川県にお住まいの保護者の方々、学校関係者の方々、市や県の職員の方々、あるいは関連事業者の方に対する表示です。

本当に子どものためを思って作っているのなら、簡単に自主規制すべきではありません。子どもたちの記憶から失われるということは、いつか誰からも忘れ去られてしまうということです。

事業者がすべきことはむしろ、「これはすごく面白いから、子どもがやるべきだ」と、もっと強くアピールすることなのです。

以上、 GitHub で政治の話をする不道徳な行為をお許し下さい。曖昧な自然言語による前書きはこのくらいにして、動くコードの話をします。

## How to use

- Heroku にデプロイして使う場合

[IPInfoDB](https://ipinfodb.com/api) でアカウントを作成して、 API Key を入手してください

Deploy to Heroku をクリックして、 `IPINFODB_API_KEY` に API Key を設定してください

[![Deploy](https://www.herokucdn.com/deploy/button.svg)](https://heroku.com/deploy?template=https://github.com/teramotodaiki/clarisse/blob/master)

あとは `/index.js` を script タグで読み込むだけです

- script タグで埋め込む場合（非推奨）

要するに僕が仮で建てた Heroku app を利用する使い方ですが、IP Geolocation の無料垢を使っているので２秒に１リクエストしか捌けません。アクセスが集中すると判定処理をスキップします。実験用にどうぞ

```html
<script async src="https://clarisse-451.herokuapp.com/index.js">
```

## How it works

IP Geolocation とは、 IP アドレスがおよそ地域ごとに割り振られていることを利用して、 IP アドレスから地域を推測してやろうというものです

原理的に 100% 正しいという保証はありません。現在は IPInfoDB の無償版を使っているので精度が低いようです。香川でのデバッグもまだ出来ていません

[server.js](server.js) に書いてありますが、まず IP Geolocation をして `regionName` を取得します

`regionName` が `Kagawa` であれば [kagawa.js](static/kagawa.js) にリダイレクトします。これはブラウザ側で実行する js です

それ以外の地域か、あるいは前回の API リクエストから 500ms 経っていない場合は空のレスポンスを返します。ブラウザ側では何も起こりません

API リクエストを減らすために判定結果をメモリにキャッシュしています。これはデプロイしなおすと消えます

UI がひどいので、 Contribute してくれるとありがたいです
